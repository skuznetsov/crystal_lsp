# GPT-5 Handoff Log

Timestamp: $(date -Iseconds)

## Repo state
- Current branch: main (clean). Last commit: 4648288 "feat: honor extend mixins in symbol collection".
- Local user file to ignore: .claude/settings.local.json.

## LSP tests
- Ran `CRYSTAL_CACHE_DIR=/tmp/crystal_cache ./tools/lsp_tests.py` -> PASS (diagnostics empty; hover Time.monotonic; definition Time/JSON/OptionParser resolved to stdlib).

## Recent changes summary (from history)
- Prelude symbol-only path available (ServerConfig#prelude_symbol_only or env LSP_PRELUDE_SYMBOL_ONLY=1).
- NameResolver resolves constant paths; reduced undefined diagnostics to top-level only.
- SymbolCollector handles extend mixins; include/extend visited in resolver.
- Constructor resolution new->initialize, request watchdog, prelude diagnostic logging suppression.

## Known gaps / TODO.md focus
- Semantic/type parity still minimal: no full ivar/cvar/global lookup, overload resolution, union/nil flow, limited type graph. Prelude still relies on symbol-only workaround; goal is real prelude without diagnostics.
- Parser zero diagnostics on stdlib reported by Claude in collab_logs/20251125-142342-claude.md, but commits not in repo; need to verify if parser currently clean.
- LSP occasional spinner reports previously; watchdog exists via LSP_WATCHDOG_TIMEOUT_MS env.
- Diagnostics in prelude: still get "undefined local variable or method" when using real prelude; root cause likely missing semantic resolution.
- References feature untested; tests cover diagnostics/hover/definition only.

## Next steps (suggested)
1) Verify parser diagnostic status (`crystal run tools/count_parser_diagnostics.cr` with ENABLE_WATCHDOG as needed); if regressions, reapply zero-diagnostic fixes noted in collab log (suppression for various recoveries, etc.).
2) Push semantic parity: add symbols for ivars/cvars/globals, improve NameResolver lookup and type inference to stop prelude undefined diagnostics; remove need for symbol-only prelude.
3) Expand LSP regression tests to cover references and constructor alias cases (Handler.new, JSON::Serializable, etc.) and guard against misroutes.
4) Investigate prelude load performance/spinners; consider default REQUEST_WATCHDOG_MS and ensure prelude caching uses real stdlib path.

## Logs to check
- collab_logs/20251125-142342-claude.md for parser suppressions that achieved 0 diags.

